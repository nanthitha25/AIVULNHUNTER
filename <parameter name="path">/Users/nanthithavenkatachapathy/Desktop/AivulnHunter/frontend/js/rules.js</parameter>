<parameter name="content">/**
 * Rules API - Fetch and manage security rules
 */

const API_URL = "http://127.0.0.1:8000";

/**
 * Load rules from the backend API
 */
async function loadRules() {
  const token = localStorage.getItem("token");
  const rulesContainer = document.getElementById("rulesContainer");

  if (!token) {
    if (rulesContainer) {
      rulesContainer.innerHTML = `
        <div class="info-box">
          <h3>üîê Login Required</h3>
          <p>Please login to view rules.</p>
        </div>
      `;
    }
    return;
  }

  try {
    const res = await fetch(`${API_URL}/rules`, {
      method: "GET",
      headers: {
        "Authorization": `Bearer ${token}`,
        "Content-Type": "application/json"
      }
    });

    if (!res.ok) {
      if (res.status === 401) {
        localStorage.removeItem("token");
        localStorage.removeItem("role");
        window.location.href = "admin_login.html";
        return;
      }
      throw new Error(`HTTP ${res.status}: ${res.statusText}`);
    }

    const rules = await res.json();
    renderRules(rules);

  } catch (err) {
    console.error("Failed to load rules:", err);
    if (rulesContainer) {
      rulesContainer.innerHTML = `
        <div class="card ERROR">
          <h3>‚ùå Error</h3>
          <p>Failed to load rules: ${err.message}</p>
        </div>
      `;
    }
  }
}

/**
 * Render rules to the DOM
 * @param {Array} rules - Array of rule objects
 */
function renderRules(rules) {
  const container = document.getElementById("rulesContainer");
  if (!container) return;

  if (!rules || rules.length === 0) {
    container.innerHTML = `
      <div class="info-box">
        <h3>No Rules Found</h3>
        <p>No security rules are currently configured.</p>
      </div>
    `;
    return;
  }

  container.innerHTML = rules.map(rule => `
    <div class="rule-card" data-id="${rule.id || rule.rule_id}">
      <div class="rule-header">
        <h4>${rule.name || rule.rule_name || "Unnamed Rule"}</h4>
        <span class="severity-badge ${(rule.severity || "UNKNOWN").toLowerCase()}">
          ${rule.severity || "UNKNOWN"}
        </span>
      </div>
      <div class="rule-body">
        <p><strong>OWASP:</strong> ${rule.owasp || "N/A"}</p>
        <p><strong>Priority:</strong> ${rule.priority || rule.rule_priority || "N/A"}</p>
        <p><strong>Description:</strong> ${rule.description || rule.explanation || "No description"}</p>
      </div>
  `).join("");
}

// Load rules on page load
document.addEventListener("DOMContentLoaded", function() {
  loadRules();
});

// Export for use
window.loadRules = loadRules;
</parameter>
</invoke_name>
