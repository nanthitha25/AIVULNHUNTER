<!DOCTYPE html>
<html>
<head>
  <title>Admin – Vulnerability Rules</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

<h2>Admin – Vulnerability Rules</h2>

<button onclick="loadRules()">Load Rules</button>
<button onclick="logout()">Logout</button>

<pre id="rules"></pre>

<h3>Add Rule</h3>
<input id="name" placeholder="Rule Name">
<input id="type" placeholder="Target Type (LLM/API)">
<input id="risk" placeholder="Risk (1-10)">
<input id="owasp" placeholder="OWASP ID">
<button onclick="addRule()">Add</button>

<script>
async function loadRules() {
  const token = localStorage.getItem("adminToken");
  if (!token) {
    document.getElementById("rules").innerText = "Please login first";
    return;
  }

  const res = await fetch("http://127.0.0.1:8000/admin/rules", {
    headers: {
      "token": token
    }
  });
  
  if (res.status === 403) {
    document.getElementById("rules").innerText = "Session expired. Please login again.";
    return;
  }
  
  document.getElementById("rules").innerText =
    JSON.stringify(await res.json(), null, 2);
}

async function addRule() {
  const token = localStorage.getItem("adminToken");
  if (!token) {
    alert("Please login first");
    return;
  }

  await fetch("http://127.0.0.1:8000/admin/rules", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "token": token
    },
    body: JSON.stringify({
      name: name.value,
      target_type: type.value,
      risk: parseInt(risk.value),
      owasp: owasp.value,
      enabled: true
    })
  });
  loadRules();
}

function logout() {
  localStorage.removeItem("adminToken");
  window.location.href = "admin_login.html";
}
</script>

</body>
</html>


